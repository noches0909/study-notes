# 微前端介绍

## 痛点

1. 项目迭代多了之后，代码量大，巨石项目
2. 不同的项目有不同的技术栈，无法统一管理

> 单页面应用（SPA）催生了服务端渲染（SSR）和微前端

## iframe

iframe 是最初的解决方案，十分简单，应用独立，就是将其它浏览器嵌套进当前的页面。

缺点太多：性能开销大、页面渲染慢，隔离性差、跨域访问困难（借助 postmessage）

## 微前端框架

主应用负责路由和子应用的加载，子应用完全隔离，独立部署，书写具体的业务逻辑

### single-spa

最早开源的微前端框架，基于 webpack 构建，框架无关性，集成不同的技术栈。
复杂度高，性能消耗高

- 预先注册子应用(激活路由、子应用资源、生命周期函数)
- 监听路由的变化，匹配到了激活的路由则加载子应用资源，顺序调用生命周期函数并最终渲染到容器

```js
import { registerApplication, start } from "single-spa"

// 注册一个子应用
registerApplication({
  name: "react-app",
  app: () => System.import("react-app"),
  activeWhen: ["/react"],
})

// 启动应用
start()
```

#### qiankun

阿里开源，基于 single-spa，简化微前端的使用，沙箱机制。

- 子应用资源由 js 列表修改进为一个 url，大大减轻注册子应用的复杂度
- 实现应用隔离，完成 js 隔离方案 （window 工厂） 和 css 隔离方案 （类 vue 的 scoped）
- 增加资源预加载能力，预先子应用 html、js、css 资源缓存下来，加快子应用的打开速度

```js
import { initGlobalState, registerMicroApps, start } from "qiankun"

registerMicroApps([
  {
    name: "react-app",
    entry: "//localhost:3000",
    // 挂载点
    container: "#react-container",
    // 激活规则
    activeRule: "/react",
  },
])

start()
```

### wujie

美团推出，基于 webComponent 容器 + iframe 沙箱

### macro-app

主打宏应用和微模块，模块化、组件化。

### garfish

字节开源，简化微前端的集成和管理。
